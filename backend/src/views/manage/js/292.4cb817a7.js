"use strict";(self["webpackChunkvue3_nb0"]=self["webpackChunkvue3_nb0"]||[]).push([[292],{71332:(e,t,a)=>{var l=a(20622),i=a(25325),n=a(72559).f,u=a(39583),r=a(75677),o=a(72402),s=a(97303),c=a(13870),d=a(34841),p=i("".endsWith),g=i("".slice),v=Math.min,f=c("endsWith"),m=!d&&!f&&!!function(){var e=n(String.prototype,"endsWith");return e&&!e.writable}();l({target:"String",proto:!0,forced:!m&&!f},{endsWith:function(e){var t=r(s(this));o(e);var a=arguments.length>1?arguments[1]:void 0,l=t.length,i=void 0===a?l:v(u(a),l),n=r(e);return p?p(t,n,i):g(t,i-n.length,i)===n}})},13292:(e,t,a)=>{a.r(t),a.d(t,{default:()=>W});a(33147),a(64746),a(67799),a(89123),a(36254),a(71332);var l=a(53262),i=a(56053),n=a(46791),u=(a(94707),function(e){return(0,l.dD)("data-v-6b910d26"),e=e(),(0,l.Cn)(),e}),r={class:"center_view"},o={class:"chat-content"},s={key:0,class:"chat_time"},c={key:1,class:"left-content"},d={key:1,controls:"",style:{width:"200px",height:"160px"}},p=["src"],g={key:2,class:"right-content"},v={key:1,controls:"",style:{width:"200px",height:"160px"}},f=["src"],m=u((function(){return(0,l._)("div",{class:"clear-float"},null,-1)})),h={class:"input_box"},w={key:0,class:"upload_box"},y={class:"save_box"};const k={__name:"list",setup:function(e){var t,a=null===(t=(0,l.FN)())||void 0===t?void 0:t.appContext.config.globalProperties,u=(0,n.iH)([]),k=(0,n.iH)({page:1,limit:20,sort:"id",order:"desc",isreply:1}),_=(0,n.iH)(!1),b=function(){var e=k.value;_.value=!0,null===a||void 0===a||a.$http({url:"chat/page",method:"get",params:e}).then((function(e){_.value=!1,u.value=e.data.data.list,W.value=Number(e.data.data.total)}))},W=(0,n.iH)(0),x=(0,n.iH)(["total","prev","pager","next","sizes","jumper"]),H=function(e){k.value.limit=e,b()},C=function(e){k.value.page=e,b()},$=(0,n.iH)(!1),D=(0,n.iH)(0),U=(0,n.iH)({reply:"",isreply:0}),j=(0,n.iH)([]),z=function(e){D.value=e.userid,S(),$.value=!0,q.value=setInterval((function(){S()}),3e3)},q=(0,n.iH)(null),T=function(){clearInterval(q.value)},V=(0,n.iH)(!0),S=function(){null===a||void 0===a||a.$http({url:"chat/page",method:"get",params:{limit:1e3,sort:"addtime",order:"asc",userid:D.value}}).then((function(e){for(var t in e.data.data.list)if(e.data.data.list[t].ask&&e.data.data.list[t].ask.split("/").length>1&&"file"==e.data.data.list[t].ask.split("/")[0]&&(e.data.data.list[t].img=e.data.data.list[t].ask),e.data.data.list[t].reply&&e.data.data.list[t].reply.split("/").length>1&&"file"==e.data.data.list[t].reply.split("/")[0]&&(e.data.data.list[t].img=e.data.data.list[t].reply),0==t)e.data.data.list[t].showTime=1;else{var a=new Date(e.data.data.list[t].addtime).getTime()-new Date(e.data.data.list[t-1].addtime).getTime();e.data.data.list[t].showTime=a>18e3?1:0}j.value=e.data.data.list,(0,l.Y3)((function(){var e=document.getElementsByClassName("chat-content")[0];setTimeout((function(){e&&(e.scrollTop+e.clientHeight==e.scrollHeight||V.value)&&(e.scrollTop=e.scrollHeight,V.value=!1)}),100)}))}))},I=function(){U.value.userid=D.value,U.value.reply&&(null===a||void 0===a||a.$http({url:"chat/save",method:"post",data:U.value}).then((function(e){null===a||void 0===a||a.$toolUtil.message("发送成功","success",(function(){S(),U.value.reply=""}))})))},N=(0,n.iH)("".concat(null===a||void 0===a?void 0:a.$config.name,"/file/upload")),P=(0,n.iH)(!1),Y=function(e){var t={reply:"file/"+e.file,userid:D.value};null===a||void 0===a||a.$http({url:"chat/save",method:"post",data:t}).then((function(e){null===a||void 0===a||a.$toolUtil.message("发送成功","success",(function(){S(),U.value.reply=""}))}))},B=function(){b()};return B(),function(e,t){var a=(0,l.up)("el-table-column"),n=(0,l.up)("el-tag"),b=(0,l.up)("el-button"),D=(0,l.up)("el-table"),q=(0,l.up)("el-pagination"),V=(0,l.up)("el-alert"),S=(0,l.up)("el-image"),B=(0,l.up)("el-input"),E=(0,l.up)("el-upload"),F=(0,l.up)("el-form"),K=(0,l.up)("el-dialog"),M=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",r,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(D,{data:u.value,border:"",stripe:!1},{default:(0,l.w5)((function(){return[(0,l.Wm)(a,{prop:"ask",resizable:!0,sortable:!0,align:"left","header-align":"left",label:"新消息"},{default:(0,l.w5)((function(e){return[(0,l.Uk)((0,i.zw)(e.row.ask),1)]})),_:1}),(0,l.Wm)(a,{prop:"ask",resizable:!0,sortable:!0,align:"left","header-align":"left",label:"状态"},{default:(0,l.w5)((function(e){return[1==e.row.isreply?((0,l.wg)(),(0,l.j4)(n,{key:0,type:"success"},{default:(0,l.w5)((function(){return[(0,l.Uk)("未回复")]})),_:1})):(0,l.kq)("",!0),0==e.row.isreply?((0,l.wg)(),(0,l.j4)(n,{key:1,type:"info"},{default:(0,l.w5)((function(){return[(0,l.Uk)("已回复")]})),_:1})):(0,l.kq)("",!0)]})),_:1}),(0,l.Wm)(a,{prop:"ask",resizable:!0,sortable:!0,align:"left","header-align":"left",label:"操作"},{default:(0,l.w5)((function(e){return[(0,l.Wm)(b,{class:"edit_btn",type:"primary",onClick:function(t){return z(e.row)}},{default:(0,l.w5)((function(){return[(0,l.Uk)("回复")]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["data"])),[[M,_.value]]),(0,l.Wm)(q,{background:"",layout:x.value.join(","),total:W.value,"page-size":k.value.limit,"current-page":k.value.page,"onUpdate:currentPage":t[0]||(t[0]=function(e){return k.value.page=e}),"prev-text":"<","next-text":">","hide-on-single-page":!1,style:{width:"100%",padding:"0",margin:"20px 0 0",whiteSpace:"nowrap",color:"#333",fontWeight:"500"},onSizeChange:H,onCurrentChange:C},null,8,["layout","total","page-size","current-page"]),(0,l.Wm)(K,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=function(e){return $.value=e}),title:"回复",width:"70%","destroy-on-close":"",onClose:T},{default:(0,l.w5)((function(){return[(0,l.Wm)(F,{ref:"formRef",model:U.value,class:"chat_view"},{default:(0,l.w5)((function(){return[(0,l._)("div",o,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(j.value,(function(t,a){return(0,l.wg)(),(0,l.iD)("div",{class:"chat-item",key:t.id},[t.showTime?((0,l.wg)(),(0,l.iD)("div",s,(0,i.zw)(t.addtime),1)):(0,l.kq)("",!0),t.ask?((0,l.wg)(),(0,l.iD)("div",c,[t.img?t.ask.endsWith(".mp4")?((0,l.wg)(),(0,l.iD)("video",d,[(0,l._)("source",{src:e.$config.url+t.ask},null,8,p)])):(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(V,{key:0,class:"text-content",title:t.ask,closable:!1,type:"success"},null,8,["title"])),t.img?((0,l.wg)(),(0,l.j4)(S,{key:2,src:e.$config.url+t.img,class:"chat_img",fit:"scale-down","preview-src-list":[e.$config.url+t.img]},null,8,["src","preview-src-list"])):(0,l.kq)("",!0)])):((0,l.wg)(),(0,l.iD)("div",g,[t.img?t.reply.endsWith(".mp4")?((0,l.wg)(),(0,l.iD)("video",v,[(0,l._)("source",{src:e.$config.url+t.reply},null,8,f)])):(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(V,{key:0,class:"text-content",title:t.reply,closable:!1,type:"warning"},null,8,["title"])),t.img?((0,l.wg)(),(0,l.j4)(S,{key:2,src:e.$config.url+t.img,class:"chat_img",fit:"scale-down","preview-src-list":[e.$config.url+t.img]},null,8,["src","preview-src-list"])):(0,l.kq)("",!0)])),m])})),128))]),(0,l._)("div",h,[(0,l.Wm)(B,{class:"input",modelValue:U.value.reply,"onUpdate:modelValue":t[1]||(t[1]=function(e){return U.value.reply=e}),placeholder:"请回复",type:"textarea"},null,8,["modelValue"]),(0,l._)("img",{src:"http://chy2.gdnxeco.com/20230912/f60a0c39a6d34289b50c151949711b67.png",class:"inp_add",onClick:t[2]||(t[2]=function(e){return P.value=!P.value}),alt:""})]),P.value?((0,l.wg)(),(0,l.iD)("div",w,[(0,l.Wm)(E,{class:"upload-demo",action:N.value,"on-success":Y,"show-file-list":!1,accept:"image/*,.mp4"},{default:(0,l.w5)((function(){return[(0,l.Wm)(b,{type:"primary"},{default:(0,l.w5)((function(){return[(0,l.Uk)("上传文件")]})),_:1})]})),_:1},8,["action"])])):(0,l.kq)("",!0),(0,l._)("div",y,[(0,l.Wm)(b,{type:"primary",onClick:I},{default:(0,l.w5)((function(){return[(0,l.Uk)("发送")]})),_:1})])]})),_:1},8,["model"])]})),_:1},8,["modelValue"])])])}}};var _=a(91859);const b=(0,_.Z)(k,[["__scopeId","data-v-6b910d26"]]),W=b}}]);
//# sourceMappingURL=292.4cb817a7.js.map